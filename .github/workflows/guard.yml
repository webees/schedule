name: guard

on:
  workflow_dispatch:

concurrency:
  group: guard
  cancel-in-progress: true      # å¤šä¸ª tick åŒæ—¶è§¦å‘æ—¶åªè·‘ä¸€ä¸ª

permissions:
  actions: write

jobs:
  revive:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” æ£€æµ‹å¹¶å”¤é†’
        env:
          GH_TOKEN: ${{ github.token }}
          REPO: ${{ github.repository }}
        run: |
          REVIVED=0
          for w in tick-a.yml tick-b.yml tick-c.yml; do
            S=$(gh run list -w $w --json status -q '.[0].status' -R $REPO --limit 1)
            if [ "$S" != "in_progress" ] && [ "$S" != "queued" ]; then
              echo "ğŸš¨ $w å·²åœæ­¢, å”¤é†’ä¸­..."
              gh workflow run $w -R $REPO
              REVIVED=$((REVIVED + 1))
              sleep 60    # äº¤é”™å¯åŠ¨, ç»´æŒ 60s é—´éš”
            else
              echo "âœ… $w å­˜æ´» (status: $S)"
            fi
          done
          echo "ğŸ“Š æœ¬æ¬¡å”¤é†’: $REVIVED æ¡é“¾"
