# Schedule

[English](README_en.md) | [ç¹é«”ä¸­æ–‡](README_zh-TW.md)

> **è®© GitHub Actions æ¯åˆ†é’Ÿç²¾ç¡®æ‰§è¡Œä¸€æ¬¡ï¼Œçªç ´ cron 5 åˆ†é’Ÿæœ€å°é—´éš”ä¸èŠ‚æµå»¶è¿Ÿã€‚**

## âœ¨ äº®ç‚¹

| | |
|---|---|
| â±ï¸ **åˆ†é’Ÿçº§ç²¾åº¦** | `time.sleep(30 - time.time() % 30)` å¯¹é½ 30 ç§’è¾¹ç•Œ |
| ğŸ”’ **åŸå­çº§å»é‡** | Git Ref åˆ›å»ºå¤©ç„¶åŸå­ï¼ŒåŒé“¾ç«æ€åªæœ‰ 1 æ¬¡æ‰§è¡Œ |
| ğŸ›¡ï¸ **7Ã—24 è‡ªæ„ˆ** | è‡ªç»­æœŸ + äº’å®ˆæŠ¤ + é”™å¼€ç©ºçª—ï¼Œæ— äººå€¼å®ˆ |
| ğŸ“¦ **æç®€ä»£ç ** | å•æ–‡ä»¶ tick.pyï¼Œé›¶å¤–éƒ¨ä¾èµ– |

---

## æ¶æ„

```
tick-a (5h,   600 rounds) â”€â”€â”
                              â”œâ”€â”€ Git Ref åŸå­é” â”€â”€â†’ å¤–éƒ¨ä»“åº“
tick-b (5.5h, 660 rounds) â”€â”€â”˜
       â†• äº’å®ˆæŠ¤ (ç›´æ¥é‡å¯å¯¹æ–¹)
```

## åŸå­é”

æ¯åˆ†é’Ÿä¸¤æ¡ tick åŒæ—¶å°è¯•åˆ›å»ºåŒå Git Refï¼ŒGitHub æœåŠ¡ç«¯ä¿è¯åªæœ‰ä¸€ä¸ªæˆåŠŸï¼š

```
tick-a: POST /git/refs â†’ 201 Created  âœ… è·é” â†’ è§¦å‘ç›®æ ‡
tick-b: POST /git/refs â†’ 422 Conflict âŒ å·²å­˜åœ¨ â†’ è·³è¿‡
```

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŸå­æ€§ | åŒå ref ä¸å¯èƒ½è¢«åˆ›å»ºä¸¤æ¬¡ |
| æ— ç«æ€ | ä¸ä¾èµ–çŠ¶æ€æŸ¥è¯¢ï¼Œæ—  API å»¶è¿Ÿçª—å£ |
| è‡ªæ¸…ç† | æ—§ lock tag æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨åˆ é™¤ |

## è‡ªæ„ˆ

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| é”™å¼€ç»­æœŸ | tick-a 600 è½® / tick-b 660 è½®ï¼Œæ°¸ä¸åŒæ—¶ç©ºçª— |
| è‡ªç»­æœŸ | è½®æ¬¡ç»“æŸè‡ªåŠ¨ `workflow_dispatch` ä¸‹ä¸€è½® |
| äº’å®ˆæŠ¤ | æ¯è½® (30s) æ£€æŸ¥å…„å¼Ÿå­˜æ´»ï¼Œæ­»äº¡åˆ™ç›´æ¥é‡å¯ |
| è‡ªæ¯ | `cancel-in-progress` + run_id æ£€æµ‹ï¼Œæ–°ä»£ç æ¨é€ç§’åˆ‡æ¢ |

| å°æ—¶ | 0 | 5 | 5.5 | 10 | 10.5 |
|------|---|---|-----|----|----- |
| tick-a | ğŸŸ¢ è¿è¡Œ | ğŸ”„ ç»­æœŸ | ğŸŸ¢ è¿è¡Œ | ğŸŸ¢ è¿è¡Œ | ğŸ”„ ç»­æœŸ |
| tick-b | ğŸŸ¢ è¿è¡Œ | ğŸŸ¢ è¿è¡Œ | ğŸ”„ ç»­æœŸ | ğŸŸ¢ è¿è¡Œ | ğŸŸ¢ è¿è¡Œ |

> è‡³å°‘æœ‰ 1 æ¡é“¾åœ¨çº¿

## å®¹é”™

| åœºæ™¯ | ç»“æœ |
|------|------|
| åŒé“¾å­˜æ´» | 2 ç«äº‰é” â†’ æ‰§è¡Œ 1 æ¬¡ âœ… |
| å•é“¾å­˜æ´» | 1 ç›´æ¥è·é” â†’ æ‰§è¡Œ 1 æ¬¡ âœ… |
| å…¨ç­ | `git push main` æˆ–æ‰‹åŠ¨è§¦å‘ä»»æ„ tick ğŸ”„ |

## æ–‡ä»¶

```
.github/workflows/
â”œâ”€â”€ tick-a.yml    å®šæ—¶å™¨ A (600 è½® â‰ˆ 5h)
â””â”€â”€ tick-b.yml    å®šæ—¶å™¨ B (660 è½® â‰ˆ 5.5h)

tick.py               å®šæ—¶å™¨ + åŸå­é” + è°ƒåº¦å™¨
```

## æ‰©å±•

å”¯ä¸€é…ç½®ï¼šSecret `DISPATCH`ï¼Œæ¯è¡Œä¸€æ¡ï¼Œæ”¯æŒä¸¤ç§æ ¼å¼ï¼š

**crontab 5 å­—æ®µ** (æœ€å°ç²’åº¦ 1 åˆ†é’Ÿ):

```
åˆ† æ—¶ æ—¥ æœˆ å‘¨  ä»“åº“  å·¥ä½œæµ
```

**ç§’çº§è¯­æ³•** (ä»»æ„é—´éš”):

```
@Ns  ä»“åº“  å·¥ä½œæµ
```

å­—æ®µè¯­æ³•åŒ crontabï¼š`*` ä»»æ„ / `*/5` æ¯ 5 / `0,30` æŒ‡å®š / `1-5` èŒƒå›´

ç¤ºä¾‹ï¼š

```
*/5 * * * *  owner/repo  check.yml
0   8 * * *  owner/repo  daily.yml
@30s         owner/repo  poll.yml
```

> **æ·»åŠ ä»»åŠ¡åªæ”¹ Secretï¼Œä¸æ”¹ä»»ä½•ä»£ç ã€‚**

## å¯åŠ¨

```bash
gh workflow run tick-a.yml && sleep 60 && gh workflow run tick-b.yml
```

æˆ– `git push main` è‡ªåŠ¨å¯åŠ¨åŒé“¾ã€‚

## æˆæƒ

[MIT](LICENSE)
