# Schedule

[English](README_en.md) | [ç¹é«”ä¸­æ–‡](README_zh-TW.md)

ç²¾å‡†è‡ªè°ƒåº¦ç³»ç»Ÿ â€” ä¸‰é“¾é©»ç•™ + å•ä¾‹æ‰§è¡Œå™¨ + å®ˆæŠ¤è€…ï¼Œç»•è¿‡ GitHub cron èŠ‚æµé™åˆ¶ã€‚

## é—®é¢˜

GitHub Actions çš„ cron è°ƒåº¦å­˜åœ¨ä¸¥é‡èŠ‚æµï¼šè®¾å®šæ¯ 5 åˆ†é’Ÿæ‰§è¡Œï¼Œå®é™…é—´éš”å¯è¾¾ 50+ åˆ†é’Ÿã€‚

## æ–¹æ¡ˆ

ä¸‰æ¡ tick é“¾åœ¨ VM å†…ä»¥ for å¾ªç¯é©»ç•™ï¼ˆæ¯è½® 5 å°æ—¶ï¼‰ï¼Œå¯¹é½æ•´åˆ†é’Ÿç²¾å‡†è§¦å‘å•ä¾‹ä¸šåŠ¡æ‰§è¡Œå™¨ã€‚

## æ¶æ„

```
tick-a (forå¾ªç¯, é©»ç•™5h, è´Ÿè´£ min%3==0) â”€â”€â”
tick-b (forå¾ªç¯, é©»ç•™5h, è´Ÿè´£ min%3==1) â”€â”€â”¼â”€â”€ æ¯åˆ†é’Ÿæ°å¥½ä¸€ä¸ªè§¦å‘ â”€â”€â†’ exec.yml (å•ä¾‹)
tick-c (forå¾ªç¯, é©»ç•™5h, è´Ÿè´£ min%3==2) â”€â”€â”˜                              â”‚
         â–²                                                               â–¼
    guard.yml (å•ä¾‹å”¤é†’è€…)                                        è§¦å‘å¤–éƒ¨ä»“åº“
```

## æ—¶åº

```
åˆ†é’Ÿ:  :00   :01   :02   :03   :04   :05   :06
tick-a: ğŸ¯                 ğŸ¯                 ğŸ¯      â† min%3==0
tick-b:       ğŸ¯                 ğŸ¯                    â† min%3==1
tick-c:             ğŸ¯                 ğŸ¯              â† min%3==2
exec:   â–ˆ    â–ˆ    â–ˆ    â–ˆ    â–ˆ    â–ˆ    â–ˆ               â† æ¯åˆ†é’Ÿä¸€æ¬¡, å•ä¾‹
```

## æ ¸å¿ƒæœºåˆ¶

### ç²¾å‡†å¯¹é½

```python
# æ¯æ¬¡å¾ªç¯å¯¹é½åˆ°æ•´åˆ†é’Ÿ
wait = 60 - (time.time() % 60)
time.sleep(wait)
```

### ä¸‰é‡å»é‡

```
1. åˆ†é’Ÿåˆ†é…: min%3 == offset â†’ æ¯åˆ†é’Ÿåªæœ‰ä¸€æ¡ tick æœ‰æƒè§¦å‘
2. çŠ¶æ€æ£€æŸ¥: è§¦å‘å‰æ£€æŸ¥ exec æ˜¯å¦ in_progress/queued â†’ è·³è¿‡
3. concurrency: exec.yml group=exec â†’ ä¸‡ä¸€åŒè§¦å‘ä¹Ÿåªè·‘ä¸€ä¸ª
```

### æ–°å®ä¾‹æ¸…ç†

```python
# å¯åŠ¨æ—¶å–æ¶ˆåŒåæ—§å®ä¾‹, ç¡®ä¿æ¯ä¸ª tick åªæœ‰ä¸€ä¸ªè¿è¡Œ
gh run list â†’ æ‰¾åˆ°å…¶ä»– in_progress çš„åŒå run â†’ gh run cancel
```

### äº’å®ˆæŠ¤

```
tick-a å‘ç° tick-b æ­»äº† â†’ è§¦å‘ guard.yml
tick-c å‘ç° tick-b æ­»äº† â†’ ä¹Ÿè§¦å‘ guard.yml â†’ è¢« cancel-in-progress ä¸¢å¼ƒ
guard å•ä¾‹è¿è¡Œ â†’ æ£€æŸ¥æ‰€æœ‰ tick â†’ å”¤èµ·æ­»æ‰çš„é“¾
```

## æ–‡ä»¶ç»“æ„

```
.github/workflows/
  tick-a.yml          å®šæ—¶å™¨ A (ä»… name ä¸åŒ)
  tick-b.yml          å®šæ—¶å™¨ B
  tick-c.yml          å®šæ—¶å™¨ C
  exec.yml            ä¸šåŠ¡æ‰§è¡Œå™¨ (å•ä¾‹)
  guard.yml           å®ˆæŠ¤è€…

scripts/
  tick.py             å®šæ—¶å™¨æ ¸å¿ƒé€»è¾‘ (ä¸‰ä¸ª tick å…±ç”¨)
  guard.py            å®ˆæŠ¤è€…é€»è¾‘
```

> tick-a/b/c ä¸‰ä¸ª workflow å®Œå…¨ä¸€è‡´ï¼Œä»… `name:` ä¸åŒï¼Œé€šè¿‡ `github.workflow` åŠ¨æ€æ¨å¯¼èº«ä»½ã€‚

## å¯åŠ¨

```bash
gh workflow run tick-a.yml && sleep 60 && gh workflow run tick-b.yml && sleep 60 && gh workflow run tick-c.yml
```

## å…¨ç­æ¢å¤

æ‰‹åŠ¨è§¦å‘ä»»æ„ä¸€æ¡ tick â†’ å®ˆæŠ¤æœºåˆ¶è‡ªåŠ¨å”¤èµ·å…¶ä»–é“¾ã€‚

## æˆæƒ

MIT
