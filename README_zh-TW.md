# Schedule

[ç®€ä½“ä¸­æ–‡](README.md) | [English](README_en.md)

> **è®“ GitHub Actions æ¯ 30 ç§’ç²¾ç¢ºåŸ·è¡Œä¸€æ¬¡ï¼Œçªç ´ cron 5 åˆ†é˜æœ€å°é–“éš”èˆ‡ç¯€æµå»¶é²ã€‚**

## âœ¨ äº®é»

| | |
|---|---|
| â±ï¸ **åˆ†é˜ç´šç²¾åº¦** | `time.sleep(30 - time.time() % 30)` å°é½ 30 ç§’é‚Šç•Œ |
| ğŸ”’ **åŸå­ç´šå»é‡** | Git Ref å‰µå»ºå¤©ç„¶åŸå­ï¼Œé›™éˆç«¶æ…‹åªæœ‰ 1 æ¬¡åŸ·è¡Œ |
| ğŸ›¡ï¸ **7Ã—24 è‡ªç™’** | è‡ªçºŒæœŸ + äº’å®ˆè­· + éŒ¯é–‹ç©ºçª—ï¼Œç„¡äººå€¼å®ˆ |
| ğŸ“¦ **æ¥µç°¡ç¨‹å¼ç¢¼** | å–®æª”æ¡ˆ tick.pyï¼Œé›¶å¤–éƒ¨ä¾è³´ |

---

## æ¶æ§‹

```
tick-a (5h,   600 rounds) â”€â”€â”
                              â”œâ”€â”€ Git Ref åŸå­é– â”€â”€â†’ å¤–éƒ¨å€‰åº«
tick-b (5.5h, 660 rounds) â”€â”€â”˜
       â†• äº’å®ˆè­· (ç›´æ¥é‡å•Ÿå°æ–¹)
```

## åŸå­é–

æ¯åˆ†é˜å…©æ¢ tick åŒæ™‚å˜—è©¦å‰µå»ºåŒå Git Refï¼ŒGitHub ä¼ºæœç«¯ä¿è­‰åªæœ‰ä¸€å€‹æˆåŠŸï¼š

```
tick-a: POST /git/refs â†’ 201 Created  âœ… ç²é– â†’ è§¸ç™¼ç›®æ¨™
tick-b: POST /git/refs â†’ 422 Conflict âŒ å·²å­˜åœ¨ â†’ è·³é
```

| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| åŸå­æ€§ | åŒå ref ä¸å¯èƒ½è¢«å‰µå»ºå…©æ¬¡ |
| ç„¡ç«¶æ…‹ | ä¸ä¾è³´ç‹€æ…‹æŸ¥è©¢ï¼Œç„¡ API å»¶é²çª—å£ |
| è‡ªæ¸…ç† | èˆŠ lock tag æ¯ 5 åˆ†é˜è‡ªå‹•åˆªé™¤ |

## è‡ªç™’

| æ©Ÿåˆ¶ | èªªæ˜ |
|------|------|
| éŒ¯é–‹çºŒæœŸ | tick-a 600 è¼ª / tick-b 660 è¼ªï¼Œæ°¸ä¸åŒæ™‚ç©ºçª— |
| è‡ªçºŒæœŸ | è¼ªæ¬¡çµæŸè‡ªå‹• `workflow_dispatch` ä¸‹ä¸€è¼ª |
| äº’å®ˆè­· | æ¯è¼ª (30s) æª¢æŸ¥å…„å¼Ÿå­˜æ´»ï¼Œæ­»äº¡å‰‡ç›´æ¥é‡å•Ÿ |
| è‡ªæ¯€ | `cancel-in-progress` + run_id åµæ¸¬ï¼Œæ–°ç¨‹å¼ç¢¼æ¨é€ç§’åˆ‡æ› |

| å°æ™‚ | 0 | 5 | 5.5 | 10 | 10.5 |
|------|---|---|-----|----|----- |
| tick-a | ğŸŸ¢ é‹è¡Œ | ğŸ”„ çºŒæœŸ | ğŸŸ¢ é‹è¡Œ | ğŸŸ¢ é‹è¡Œ | ğŸ”„ çºŒæœŸ |
| tick-b | ğŸŸ¢ é‹è¡Œ | ğŸŸ¢ é‹è¡Œ | ğŸ”„ çºŒæœŸ | ğŸŸ¢ é‹è¡Œ | ğŸŸ¢ é‹è¡Œ |

> è‡³å°‘æœ‰ 1 æ¢éˆåœ¨ç·š

## å®¹éŒ¯

| å ´æ™¯ | çµæœ |
|------|------|
| é›™éˆå­˜æ´» | 2 ç«¶çˆ­é– â†’ åŸ·è¡Œ 1 æ¬¡ âœ… |
| å–®éˆå­˜æ´» | 1 ç›´æ¥ç²é– â†’ åŸ·è¡Œ 1 æ¬¡ âœ… |
| å…¨æ»… | `git push main` æˆ–æ‰‹å‹•è§¸ç™¼ä»»æ„ tick ğŸ”„ |

## æª”æ¡ˆ

```
.github/workflows/
â”œâ”€â”€ tick-a.yml    å®šæ™‚å™¨ A (600 è¼ª â‰ˆ 5h)
â””â”€â”€ tick-b.yml    å®šæ™‚å™¨ B (660 è¼ª â‰ˆ 5.5h)

tick.py               å®šæ™‚å™¨ + åŸå­é– + èª¿åº¦å™¨
```

## æ“´å±•

å”¯ä¸€é…ç½®ï¼šSecret `DISPATCH`ï¼Œæ¯è¡Œä¸€æ¢ï¼Œæ”¯æ´å…©ç¨®æ ¼å¼ï¼š

**crontab 5 å­—æ®µ** (æœ€å°ç²’åº¦ 1 åˆ†é˜):

```
åˆ† æ™‚ æ—¥ æœˆ é€±  å€‰åº«  å·¥ä½œæµ
```

**ç§’ç´šèªæ³•** (ä»»æ„é–“éš”):

```
@Ns  å€‰åº«  å·¥ä½œæµ
```

å­—æ®µèªæ³•åŒ crontabï¼š`*` ä»»æ„ / `*/5` æ¯ 5 / `0,30` æŒ‡å®š / `1-5` ç¯„åœ

ç¤ºä¾‹ï¼š

```
*/5 * * * *  owner/repo  check.yml
0   8 * * *  owner/repo  daily.yml
@30s         owner/repo  poll.yml
```

> **æ·»åŠ ä»»å‹™åªæ”¹ Secretï¼Œä¸æ”¹ä»»ä½•ç¨‹å¼ç¢¼ã€‚**

## å•Ÿå‹•

```bash
gh workflow run tick-a.yml && sleep 60 && gh workflow run tick-b.yml
```

æˆ– `git push main` è‡ªå‹•å•Ÿå‹•é›™éˆã€‚

## æˆæ¬Š

[MIT](LICENSE)
